<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>rex Virtual Joystick Test</title>
    <style>
      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        padding: 0;
        background: #111;
        color: #eee;
        font: caption;
      }

      #version {
        position: absolute;
        left: 5px;
        top: 605px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.js"></script>
    <script>
      class Demo extends Phaser.Scene {
        constructor() {
          super({ key: 'examples' });
        }

        preload() {
          const url =
            'https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexvirtualjoystickplugin.min.js';
          this.load.plugin('rexvirtualjoystickplugin', url, true);
        }

        create() {
          this.joyStick = this.plugins
            .get('rexvirtualjoystickplugin')
            .add(this, {
              x: 400,
              y: 300,
              radius: 100,
              base: this.add.circle(0, 0, 100, 0x888888),
              thumb: this.add.circle(0, 0, 50, 0xcccccc)
            })
            .on('update', this.dumpJoyStickState, this);

          this.text = this.add.text(0, 0, '');
          this.dumpJoyStickState();
        }

        dumpJoyStickState() {
          const cursorKeys = this.joyStick.createCursorKeys();
          let s = 'Key down: ';
          for (const name in cursorKeys) {
            if (cursorKeys[name].isDown) {
              s += `${name} `;
            }
          }

          s += `\nForce: ${Math.floor(this.joyStick.force * 100) / 100}`;
          s += `\nAngle: ${Math.floor(this.joyStick.angle * 100) / 100}\n`;

          s += '\nTimestamp:\n';
          for (const name in cursorKeys) {
            const key = cursorKeys[name];
            s += `${name}: duration=${key.duration / 1000}\n`;
          }
          this.text.setText(s);
        }
      }

      const config = {
        type: Phaser.AUTO,
        parent: 'phaser-example',
        width: 800,
        height: 600,
        scale: {
          mode: Phaser.Scale.FIT,
          autoCenter: Phaser.Scale.CENTER_BOTH
        },
        scene: Demo,
        backgroundColor: 0x333333
      };

      window.addEventListener('load', () => {
        document.getElementById('version').textContent = `Phaser ${Phaser.VERSION}`;
        // eslint-disable-next-line no-new
        new Phaser.Game(config);
      });
    </script>
  </head>
  <body>
    <footer><div id="version"></div></footer>
    <div id="phaser-example"></div>
  </body>
</html>
